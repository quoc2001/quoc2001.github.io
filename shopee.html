<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/shopee.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Shopee Affiliate Link Generator</title>
</head>
<body>
    <a href="index.html" class="back-button">
        <i class="fa-solid fa-backward"></i>
        <span class="contact-text">Go back</span>
    </a>
    <div class="container">
        <h1>üõçÔ∏è Shopee Affiliate Link Generator</h1>
        <div class="subtitle">T·ª± ƒë·ªông t·∫°o link mua h√†ng Shopee (Ti·∫øp th·ªã li√™n k·∫øt)</div>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è CH·ªà h·ªó tr·ª£ link shopee.vn:</strong><br>
            ‚Ä¢ shopee.vn/product/... ‚úÖ<br>
            ‚Ä¢ shopee.vn/t√™n-s·∫£n-ph·∫©m-i.... ‚úÖ<br>
            ‚Ä¢ s.shopee.vn/... ‚ùå KH√îNG h·ªó tr·ª£<br>
            ‚Ä¢ C√°c link kh√°c (lazada, tiki, amazon...) ‚ùå KH√îNG h·ªó tr·ª£
        </div>
        
        <div class="info-box">
            <strong>üí° C√°ch s·ª≠ d·ª•ng:</strong><br>
            ‚Ä¢ L·∫•y link s·∫£n ph·∫©m mu·ªën mua trong ·ª©ng d·ª•ng/web Shopee v√† d√°n v√†o √¥ b√™n d∆∞·ªõi<br>
            ‚Ä¢ Tool s·∫Ω t·∫°o affiliate link v·ªõi tracking parameters<br>
            ‚Ä¢ Click n√∫t "üõçÔ∏è M·ªü S·∫£n Ph·∫©m" ƒë·ªÉ chia s·∫ª v√† mua h√†ng<br>
            ‚Ä¢ H·ªó tr·ª£ t·∫•t c·∫£ lo·∫°i link shopee.vn: product, named-product
        </div>
        
        <div class="input-group">
            <label for="inputLinks">üìã Nh·∫≠p link s·∫£n ph·∫©m b·∫°n mu·ªën mua v√†o ƒë√¢y</label>
            <textarea id="inputLinks" rows="3" placeholder="D√°n link s·∫£n ph·∫©m Shopee v√†o ƒë√¢y:
https://shopee.vn/product/1264383914/26138270984"></textarea>
        </div>
        
        <div class="button-group">
            <button class="btn-convert" onclick="generateAffiliateLinks()">üîÑ T·∫°o Li√™n K·∫øt</button>
            <button class="btn-copy" onclick="copyAllResults()">üìã Sao ch√©p</button>
            <button class="btn-clear" onclick="clearAll()">üóëÔ∏è X√≥a H·∫øt</button>
        </div>
        
        <div id="resultsSection" class="result-area" style="display: none;">
            <div class="stats">
                <span>T·ªïng li√™n k·∫øt: <span id="totalLinks">0</span></span>
                <span>ƒê√£ t·∫°o: <span id="generatedCount">0</span></span>
                <span>L·ªói: <span id="errorCount">0</span></span>
            </div>
            
            <div id="generatedLinks"></div>
        </div>
        
        <div id="successMessage" class="success-message">
            ‚úÖ ƒê√£ sao ch√©p affiliate link th√†nh c√¥ng!
        </div>
        
        <div id="errorMessage" class="error-message"></div>
    </div>

    <script>
        const AFFILIATE_ID = '17309510004';
        
        function generateRandomId(length = 8) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function generateRandomCampaignId() {
            return 'id_' + generateRandomId(10);
        }
        
        function generateRandomTerm() {
            return generateRandomId(12);
        }
        
        function generateGadsSignature() {
            // T·∫°o gads_t_sig gi·∫£ l·∫≠p
            return 'VTJGc2RHVmtYMTlxTFVSVVRrdENkZmdTUmpMeSszRElEdm91eXFrOVhzNS9BUFZoV3EvdzBSejdLalVDMURHQ1Z6TVI1b3NuSmxLR1IxalhlcDl5OWlnb00vdnZhSUdlRHlaeXRjQXJoTjdNUk94aGhYTVZUbUpZaGR0RVhCM29RUzJDc01rKytHOW41VDNPV3JtQmoyYWtSRjNQSkVDUkk3WnNmZW5lMjNFPQ';
        }
        
        function generateTrackingId() {
            return generateRandomId(12);
        }
        
        function isValidShopeeLink(url) {
            // CH·ªà ch·∫•p nh·∫≠n link shopee.vn, KH√îNG ch·∫•p nh·∫≠n s.shopee.vn
            const shopeePatterns = [
                /^https?:\/\/shopee\.vn\//,
                /^shopee\.vn\//
            ];
            
            return shopeePatterns.some(pattern => pattern.test(url.toLowerCase()));
        }
        
        function extractProductInfo(url) {
            // Ki·ªÉm tra xem c√≥ ph·∫£i link shopee.vn kh√¥ng (lo·∫°i b·ªè s.shopee.vn)
            if (!isValidShopeeLink(url)) {
                return null;
            }
            
            // ƒê·∫£m b·∫£o URL c√≥ protocol
            let processUrl = url;
            if (!processUrl.startsWith('http')) {
                processUrl = 'https://' + processUrl;
            }
            
            // Lo·∫°i b·ªè parameters c≈© ƒë·ªÉ l·∫•y base URL
            const cleanUrl = processUrl.split('?')[0];
            
            // Pattern 1: https://shopee.vn/product/shopid/itemid
            const pattern1 = /shopee\.vn\/product\/(\d+)\/(\d+)/;
            const match1 = cleanUrl.match(pattern1);
            if (match1) {
                return {
                    shopId: match1[1],
                    itemId: match1[2],
                    baseUrl: cleanUrl,
                    type: 'product'
                };
            }
            
            // Pattern 2: https://shopee.vn/product-name-i.shopid.itemid
            const pattern2 = /shopee\.vn\/.*-i\.(\d+)\.(\d+)/;
            const match2 = cleanUrl.match(pattern2);
            if (match2) {
                return {
                    shopId: match2[1],
                    itemId: match2[2],
                    baseUrl: cleanUrl,
                    type: 'named_product'
                };
            }
            
            // Pattern 3: B·∫•t k·ª≥ link shopee.vn n√†o kh√°c
            if (cleanUrl.includes('shopee.vn/')) {
                return {
                    baseUrl: cleanUrl,
                    type: 'general'
                };
            }
            
            return null;
        }
        
        function createAffiliateLink(productInfo) {
            if (!productInfo) return null;
            
            // T·∫°o full tracking parameters cho t·∫•t c·∫£ link shopee.vn
            const trackingParams = new URLSearchParams({
                'gads_t_sig': generateGadsSignature(),
                'uls_trackid': generateTrackingId(),
                'utm_campaign': generateRandomCampaignId(),
                'utm_content': '----',
                'utm_medium': 'affiliates',
                'utm_source': `an_${AFFILIATE_ID}`,
                'utm_term': generateRandomTerm()
            });
            
            return `${productInfo.baseUrl}?${trackingParams.toString()}`;
        }
        
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.innerHTML = `<strong>‚ùå L·ªói:</strong> ${message}`;
            errorMessage.style.display = 'block';
            
            // ·∫®n th√¥ng b√°o sau 5 gi√¢y
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }
        
        function hideError() {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.style.display = 'none';
        }
        
        function generateAffiliateLinks() {
            hideError();
            
            const input = document.getElementById('inputLinks').value.trim();
            
            if (!input) {
                showError('Vui l√≤ng nh·∫≠p link s·∫£n ph·∫©m Shopee.vn!');
                return;
            }
            
            // Ch·ªâ l·∫•y link ƒë·∫ßu ti√™n n·∫øu c√≥ nhi·ªÅu link
            const links = input.split('\n').filter(link => link.trim());
            const firstLink = links[0].trim();
            
            if (links.length > 1) {
                // Th√¥ng b√°o n·∫øu c√≥ nhi·ªÅu link nh∆∞ng ch·ªâ x·ª≠ l√Ω link ƒë·∫ßu
                const confirmProcess = confirm(`Ph√°t hi·ªán ${links.length} links. Ch·ªâ x·ª≠ l√Ω link ƒë·∫ßu ti√™n:\n"${firstLink.substring(0, 80)}..."\n\nClick OK ƒë·ªÉ ti·∫øp t·ª•c ho·∫∑c Cancel ƒë·ªÉ ch·ªânh s·ª≠a.`);
                if (!confirmProcess) return;
            }
            
            // Ki·ªÉm tra xem c√≥ ph·∫£i link shopee.vn kh√¥ng
            if (!isValidShopeeLink(firstLink)) {
                showError(`Link n√†y kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£! CH·ªà ch·∫•p nh·∫≠n link t·ª´:<br>
                    ‚Ä¢ shopee.vn/product/... <br>
                    ‚Ä¢ shopee.vn/t√™n-s·∫£n-ph·∫©m-i... <br><br>
                    <strong>KH√îNG h·ªó tr·ª£:</strong><br>
                    ‚Ä¢ s.shopee.vn/...<br>
                    ‚Ä¢ C√°c trang kh√°c (lazada, tiki, amazon...)<br><br>
                    <strong>Link b·∫°n nh·∫≠p:</strong> ${firstLink.length > 100 ? firstLink.substring(0, 100) + '...' : firstLink}`);
                return;
            }
            
            const productInfo = extractProductInfo(firstLink);
            const affiliateLink = createAffiliateLink(productInfo);
            
            if (affiliateLink) {
                const result = {
                    original: firstLink,
                    affiliateLink: affiliateLink,
                    productInfo: productInfo,
                    status: 'success'
                };
                displaySingleResult(result);
            } else {
                const result = {
                    original: firstLink,
                    affiliateLink: 'Kh√¥ng th·ªÉ t·∫°o affiliate link cho URL n√†y',
                    status: 'error'
                };
                displaySingleResult(result);
            }
        }
        
        function displaySingleResult(result) {
            hideError();
            
            const resultsSection = document.getElementById('resultsSection');
            const generatedLinks = document.getElementById('generatedLinks');
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            document.getElementById('totalLinks').textContent = '1';
            document.getElementById('generatedCount').textContent = result.status === 'success' ? '1' : '0';
            document.getElementById('errorCount').textContent = result.status === 'success' ? '0' : '1';
            
            // X√≥a k·∫øt qu·∫£ c≈©
            generatedLinks.innerHTML = '';
            
            // T·∫°o k·∫øt qu·∫£ m·ªõi v·ªõi style ƒë·∫∑c bi·ªát cho single link
            const linkDiv = document.createElement('div');
            linkDiv.className = 'converted-link';
            linkDiv.style.borderLeft = result.status === 'success' ? '4px solid #27ae60' : '4px solid #e74c3c';
            linkDiv.style.textAlign = 'center'; // Center align cho single link
            
            if (result.status === 'success') {
                linkDiv.innerHTML = `
                    <div style="font-weight: bold; color: #27ae60; margin-bottom: 15px; font-size: 16px;">
                        ‚úÖ Affiliate Link ƒê√£ S·∫µn S√†ng!
                    </div>
                    
                    <div class="link-original" style="text-align: left;">
                        <strong>Link g·ªëc:</strong><br>${result.original}
                    </div>
                    
                    <div class="link-container">
                        <div style="margin-bottom: 15px; color: #333; font-size: 16px; font-weight: bold;">
                            üöÄ Click ƒë·ªÉ mua ngay ho·∫∑c copy ƒë·ªÉ chia s·∫ª:
                        </div>
                        <a href="${result.affiliateLink}" target="_blank" class="clickable-link" 
                           onclick="trackClick(1)" style="font-size: 16px; padding: 15px 30px; margin: 10px;">
                            üõçÔ∏è M·ªü S·∫£n Ph·∫©m Shopee
                        </a>
                        <br>
                        <button class="btn-copy-single" onclick="copyLink('${result.affiliateLink.replace(/'/g, "\\'")}', 1)" 
                                style="font-size: 14px; padding: 12px 25px; margin-top: 10px;">
                            üìã Copy Affiliate Link
                        </button>
                        <div style="margin-top: 10px; font-size: 12px; color: #999;">
                            Link s·∫Ω m·ªü trong tab m·ªõi v·ªõi tracking ƒë·∫ßy ƒë·ªß
                        </div>
                    </div>
                    
                    <details style="margin-top: 20px; text-align: left;">
                        <summary style="cursor: pointer; color: #666; font-size: 12px; margin-bottom: 10px;">
                            üìã Xem link ƒë·∫ßy ƒë·ªß v√† tracking info
                        </summary>
                        <div class="link-generated">
                            <strong>üîó Affiliate Link ƒë·∫ßy ƒë·ªß:</strong><br>
                            <div style="word-break: break-all; margin-top: 5px; font-size: 11px;">
                                ${result.affiliateLink}
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 11px; color: #666;">
                            <strong>üìä Tracking Info:</strong><br>
                            ‚Ä¢ Type: ${result.productInfo.type}<br>
                        </div>
                    </details>
                `;
            } else {
                linkDiv.innerHTML = `
                    <div style="font-weight: bold; color: #e74c3c; margin-bottom: 15px; font-size: 16px;">
                        ‚ùå Kh√¥ng th·ªÉ t·∫°o link
                    </div>
                    <div class="link-original" style="text-align: left;">
                        <strong>Link g·ªëc:</strong><br>${result.original}
                    </div>
                    <div style="color: #e74c3c; font-weight: bold; margin-top: 15px; font-size: 14px;">
                        ${result.affiliateLink}
                    </div>
                `;
            }
            
            generatedLinks.appendChild(linkDiv);
            resultsSection.style.display = 'block';
        }
        
        function copyAllResults() {
            // V·ªõi single link mode, ch·ªâ copy link hi·ªán t·∫°i
            const linkDiv = document.querySelector('.converted-link .link-generated div');
            if (!linkDiv) {
                showError('Ch∆∞a c√≥ affiliate link n√†o ƒë·ªÉ copy!');
                return;
            }
            
            const linkText = linkDiv.textContent.trim();
            if (linkText && linkText.startsWith('https://')) {
                navigator.clipboard.writeText(linkText).then(() => {
                    showSuccessMessage();
                }).catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = linkText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showSuccessMessage();
                });
            } else {
                showError('Kh√¥ng c√≥ affiliate link ƒë·ªÉ copy!');
            }
        }
        
        function copyLink(link, index) {
            navigator.clipboard.writeText(link).then(() => {
                // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng t·∫°m th·ªùi
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ ƒê√£ copy!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#17a2b8';
                }, 2000);
            }).catch(() => {
                showError('Kh√¥ng th·ªÉ copy link. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }
        
        function trackClick(index) {
            console.log(`Clicked on affiliate link ${index} at ${new Date().toLocaleString()}`);
            // C√≥ th·ªÉ th√™m analytics tracking ·ªü ƒë√¢y n·∫øu c·∫ßn
        }
        
        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }
        
        function clearAll() {
            document.getElementById('inputLinks').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            hideError();
        }
        
        // Keyboard shortcut
        document.getElementById('inputLinks').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                generateAffiliateLinks();
            }
        });
        
        // Auto focus on input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('inputLinks').focus();
        });
        
        // Ki·ªÉm tra link khi ng∆∞·ªùi d√πng nh·∫≠p
        document.getElementById('inputLinks').addEventListener('input', function() {
            hideError();
        });
    </script>
</body>

</html>
