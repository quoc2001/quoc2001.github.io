<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/shopee.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Shopee Affiliate Link Generator</title>
</head>

<body>
    <a href="index.html" class="back-button">
        <i class="fa-solid fa-backward"></i>
        <span class="contact-text">Go back</span>
    </a>
    <div class="container">
        <h1>ğŸ›ï¸ Shopee Affiliate Link Generator</h1>
        <div class="subtitle">Tá»± Ä‘á»™ng táº¡o link mua hÃ ng Shopee (Tiáº¿p thá»‹ liÃªn káº¿t)</div>

        <div class="warning-box">
            <strong>âš ï¸ CHá»ˆ há»— trá»£ link shopee.vn:</strong><br>
            â€¢ shopee.vn/product/... âœ…<br>
            â€¢ shopee.vn/tÃªn-sáº£n-pháº©m-i.... âœ…<br>
            â€¢ s.shopee.vn/... âŒ KHÃ”NG há»— trá»£<br>
            â€¢ CÃ¡c link khÃ¡c (lazada, tiki, amazon...) âŒ KHÃ”NG há»— trá»£
        </div>

        <div class="info-box">
            <strong>ğŸ’¡ CÃ¡ch sá»­ dá»¥ng:</strong><br>
            â€¢ Láº¥y link sáº£n pháº©m muá»‘n mua trong á»©ng dá»¥ng/web Shopee vÃ  dÃ¡n vÃ o Ã´ bÃªn dÆ°á»›i<br>
            â€¢ Tool sáº½ táº¡o affiliate link vá»›i tracking parameters<br>
            â€¢ Click nÃºt "ğŸ›ï¸ Má»Ÿ Sáº£n Pháº©m" Ä‘á»ƒ chia sáº» vÃ  mua hÃ ng<br>
            â€¢ Há»— trá»£ táº¥t cáº£ loáº¡i link shopee.vn: product, named-product
        </div>

        <div class="input-group">
            <label for="inputLinks">ğŸ“‹ Nháº­p link sáº£n pháº©m báº¡n muá»‘n mua vÃ o Ä‘Ã¢y</label>
            <textarea id="inputLinks" rows="3" placeholder="DÃ¡n link sáº£n pháº©m Shopee vÃ o Ä‘Ã¢y:
https://shopee.vn/product/1264383914/26138270984"></textarea>
        </div>

        <div class="button-group">
            <button class="btn-convert" onclick="generateAffiliateLinks()">ğŸ”„ Táº¡o LiÃªn Káº¿t</button>
            <button class="btn-copy" onclick="copyAllResults()">ğŸ“‹ Sao chÃ©p</button>
            <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ XÃ³a Háº¿t</button>
        </div>

        <div id="resultsSection" class="result-area" style="display: none;">
            <div class="stats">
                <span>Tá»•ng liÃªn káº¿t: <span id="totalLinks">0</span></span>
                <span>ÄÃ£ táº¡o: <span id="generatedCount">0</span></span>
                <span>Lá»—i: <span id="errorCount">0</span></span>
            </div>

            <div id="generatedLinks"></div>
        </div>

        <div id="successMessage" class="success-message">
            âœ… ÄÃ£ sao chÃ©p affiliate link thÃ nh cÃ´ng!
        </div>

        <div id="errorMessage" class="error-message"></div>
    </div>
    <script>
        const AFFILIATE_ID = '17309510004';

        function generateRandomId(length = 8) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateRandomCampaignId() {
            return 'id_' + generateRandomId(10);
        }

        function generateRandomTerm() {
            return generateRandomId(12);
        }

        function generateGadsSignature() {
            return 'VTJGc2RHVmtYMTlxTFVSVVRrdENkZmdTUmpMeSszRElEdm91eXFrOVhzNS9BUFZoV3EvdzBSejdLalVDMURHQ1Z6TVI1b3NuSmxLR1IxalhlcDl5OWlnb00vdnZhSUdlRHlaeXRjQXJoTjdNUk94aGhYTVZUbUpZaGR0RVhCM29RUzJDc01rKytHOW41VDNPV3JtQmoyYWtSRjNQSkVDUkk3WnNmZW5lMjNFPQ';
        }

        function generateTrackingId() {
            return generateRandomId(12);
        }

        // PhÃ¡t hiá»‡n link rÃºt gá»n
        function isShortLink(url) {
            const shortLinkPatterns = [
                /^https?:\/\/s\.shopee\.vn\//i,
                /^s\.shopee\.vn\//i,
                /^https?:\/\/shp\.ee\//i,
                /^shp\.ee\//i,
                /^https?:\/\/c\.shopee\.vn\//i,
                /^c\.shopee\.vn\//i,
                /shopee\.vn.*[\?&]smtt=/i,
                /shopee\.vn.*[\?&]shareChannel=/i,
                /shopee\.vn.*[\?&]deep_and_deferred=/i
            ];

            return shortLinkPatterns.some(pattern => pattern.test(url.toLowerCase()));
        }

        function isValidShopeeLink(url) {
            if (isShortLink(url)) {
                return false;
            }

            const shopeePatterns = [
                /^https?:\/\/shopee\.vn\//,
                /^shopee\.vn\//
            ];

            return shopeePatterns.some(pattern => pattern.test(url.toLowerCase()));
        }

        // Hiá»ƒn thá»‹ cáº£nh bÃ¡o link rÃºt gá»n Ä‘Æ¡n giáº£n
        function showShortLinkWarning(url) {
            const warningHTML = `
        <div style="background: linear-gradient(135deg, #ff6b6b, #feca57); color: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #ff4757;">
            <h3>ğŸš¨ PhÃ¡t hiá»‡n Link RÃºt Gá»n!</h3>
            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 10px 0;">
                <strong>ğŸ“ Link hiá»‡n táº¡i:</strong><br>
                <span style="word-break: break-all; font-family: monospace;">${url}</span>
            </div>
            <div style="font-weight: bold; font-size: 16px; margin: 15px 0;">
                âš ï¸ Cáº§n link Ä‘áº§y Ä‘á»§ Ä‘á»ƒ táº¡o affiliate link!
            </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #28a745;">
            <h4 style="color: #333; margin-bottom: 15px;">âš¡ CÃCH NHANH NHáº¤T:</h4>
            
            <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="font-weight: bold; color: #dc3545; margin-bottom: 8px;">ğŸ”¥ CÃ¡ch siÃªu nhanh - 1 click:</div>
                <div style="color: #666; font-size: 14px; margin-bottom: 10px;">
                    â€¢ Nháº¥n nÃºt Ä‘á» bÃªn dÆ°á»›i Ä‘á»ƒ tá»± Ä‘á»™ng má»Ÿ link trong tab má»›i<br>
                    â€¢ Äá»£i trang táº£i â†’ Ctrl+A Ä‘á»ƒ chá»n háº¿t URL â†’ Ctrl+C Ä‘á»ƒ copy<br>
                    â€¢ Quay láº¡i Ä‘Ã¢y vÃ  dÃ¡n (Ctrl+V) vÃ o Ã´ input
                </div>
                <button onclick="openAndGuideUser('${url.replace(/'/g, "\\\'")}')" 
                        style="background: #dc3545; color: white; border: none; padding: 12px 20px; border-radius: 25px; 
                               cursor: pointer; font-weight: bold; font-size: 16px; box-shadow: 0 3px 10px rgba(220,53,69,0.3);">
                    ğŸš€ Má»Ÿ Link & HÆ°á»›ng Dáº«n Copy
                </button>
            </div>
            
            <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="font-weight: bold; color: #007bff; margin-bottom: 8px;">ğŸŒ CÃ¡ch thÆ°á»ng:</div>
                <div style="color: #666; font-size: 14px;">
                    â€¢ Copy link rÃºt gá»n vÃ  má»Ÿ trong Chrome/Safari<br>
                    â€¢ Chá» trang redirect xong â†’ Copy URL tá»« thanh Ä‘á»‹a chá»‰
                </div>
            </div>
            
            <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="font-weight: bold; color: #28a745; margin-bottom: 8px;">ğŸ“± Tá»« app Shopee:</div>
                <div style="color: #666; font-size: 14px;">
                    â€¢ Má»Ÿ sáº£n pháº©m â†’ "Chia sáº»" â†’ "Xem trong trÃ¬nh duyá»‡t"<br>
                    â€¢ Copy URL tá»« thanh Ä‘á»‹a chá»‰ trÃ¬nh duyá»‡t
                </div>
            </div>
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3;">
                <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px;">ğŸ’¡ Link Ä‘áº§y Ä‘á»§ cÃ³ dáº¡ng:</div>
                <div style="color: #1976d2; font-size: 14px; font-family: monospace;">
                    â€¢ shopee.vn/product/123456/789012<br>
                    â€¢ shopee.vn/tÃªn-sáº£n-pháº©m-i.123456.789012
                </div>
            </div>
        </div>
    `;

            showError(warningHTML, 60000); // Hiá»ƒn thá»‹ 60 giÃ¢y
        }

        function extractProductInfo(url) {
            if (!isValidShopeeLink(url)) {
                return null;
            }

            let processUrl = url;
            if (!processUrl.startsWith('http')) {
                processUrl = 'https://' + processUrl;
            }

            const cleanUrl = processUrl.split('?')[0];

            // Pattern 1: https://shopee.vn/product/shopid/itemid
            const pattern1 = /shopee\.vn\/product\/(\d+)\/(\d+)/;
            const match1 = cleanUrl.match(pattern1);
            if (match1) {
                return {
                    shopId: match1[1],
                    itemId: match1[2],
                    baseUrl: cleanUrl,
                    type: 'product'
                };
            }

            // Pattern 2: https://shopee.vn/product-name-i.shopid.itemid
            const pattern2 = /shopee\.vn\/.*-i\.(\d+)\.(\d+)/;
            const match2 = cleanUrl.match(pattern2);
            if (match2) {
                return {
                    shopId: match2[1],
                    itemId: match2[2],
                    baseUrl: cleanUrl,
                    type: 'named_product'
                };
            }

            // Pattern 3: Báº¥t ká»³ link shopee.vn nÃ o khÃ¡c
            if (cleanUrl.includes('shopee.vn/')) {
                return {
                    baseUrl: cleanUrl,
                    type: 'general'
                };
            }

            return null;
        }

        function createAffiliateLink(productInfo) {
            if (!productInfo) return null;

            const trackingParams = new URLSearchParams({
                'gads_t_sig': generateGadsSignature(),
                'uls_trackid': generateTrackingId(),
                'utm_campaign': generateRandomCampaignId(),
                'utm_content': '----',
                'utm_medium': 'affiliates',
                'utm_source': `an_${AFFILIATE_ID}`,
                'utm_term': generateRandomTerm()
            });

            return `${productInfo.baseUrl}?${trackingParams.toString()}`;
        }

        function showError(message, duration = 5000) {
            const errorMessage = document.getElementById('errorMessage');
            if (!errorMessage) return;

            errorMessage.innerHTML = typeof message === 'string' && message.includes('<') ? message : `<strong>âŒ Lá»—i:</strong> ${message}`;
            errorMessage.style.display = 'block';

            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, duration);
        }

        function hideError() {
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage) {
                errorMessage.style.display = 'none';
            }
        }

        function generateAffiliateLinks() {
            hideError();

            const input = document.getElementById('inputLinks').value.trim();

            if (!input) {
                showError('Vui lÃ²ng nháº­p link sáº£n pháº©m Shopee.vn!');
                return;
            }

            const links = input.split('\n').filter(link => link.trim());
            const firstLink = links[0].trim();

            if (links.length > 1) {
                const confirmProcess = confirm(`PhÃ¡t hiá»‡n ${links.length} links. Chá»‰ xá»­ lÃ½ link Ä‘áº§u tiÃªn:\n"${firstLink.substring(0, 80)}..."\n\nClick OK Ä‘á»ƒ tiáº¿p tá»¥c hoáº·c Cancel Ä‘á»ƒ chá»‰nh sá»­a.`);
                if (!confirmProcess) return;
            }

            // Kiá»ƒm tra link rÃºt gá»n
            if (isShortLink(firstLink)) {
                showShortLinkWarning(firstLink);
                return;
            }

            // Kiá»ƒm tra link há»£p lá»‡
            if (!isValidShopeeLink(firstLink)) {
                showError(`Link nÃ y khÃ´ng Ä‘Æ°á»£c há»— trá»£! CHá»ˆ cháº¥p nháº­n link Ä‘áº§y Ä‘á»§ tá»« shopee.vn<br><br><strong>Link báº¡n nháº­p:</strong> ${firstLink.length > 100 ? firstLink.substring(0, 100) + '...' : firstLink}`);
                return;
            }

            const productInfo = extractProductInfo(firstLink);
            const affiliateLink = createAffiliateLink(productInfo);

            if (affiliateLink) {
                displaySingleResult({
                    original: firstLink,
                    affiliateLink: affiliateLink,
                    productInfo: productInfo,
                    status: 'success'
                });
            } else {
                displaySingleResult({
                    original: firstLink,
                    affiliateLink: 'KhÃ´ng thá»ƒ táº¡o affiliate link cho URL nÃ y',
                    status: 'error'
                });
            }
        }

        function displaySingleResult(result) {
            hideError();

            const resultsSection = document.getElementById('resultsSection');
            const generatedLinks = document.getElementById('generatedLinks');

            if (!resultsSection || !generatedLinks) return;

            // Cáº­p nháº­t thá»‘ng kÃª
            document.getElementById('totalLinks').textContent = '1';
            document.getElementById('generatedCount').textContent = result.status === 'success' ? '1' : '0';
            document.getElementById('errorCount').textContent = result.status === 'success' ? '0' : '1';

            generatedLinks.innerHTML = '';

            const linkDiv = document.createElement('div');
            linkDiv.className = 'converted-link';
            linkDiv.style.borderLeft = result.status === 'success' ? '4px solid #27ae60' : '4px solid #e74c3c';
            linkDiv.style.textAlign = 'center';

            if (result.status === 'success') {
                linkDiv.innerHTML = `
            <div style="font-weight: bold; color: #27ae60; margin-bottom: 15px; font-size: 16px;">
                âœ… Affiliate Link ÄÃ£ Sáºµn SÃ ng!
            </div>
            
            <div class="link-original" style="text-align: left;">
                <strong>Link gá»‘c:</strong><br>${result.original}
            </div>
            
            <div class="link-container">
                <div style="margin-bottom: 15px; color: #333; font-size: 16px; font-weight: bold;">
                    ğŸš€ Click Ä‘á»ƒ mua ngay hoáº·c copy Ä‘á»ƒ chia sáº»:
                </div>
                <a href="${result.affiliateLink}" target="_blank" class="clickable-link" 
                   onclick="trackClick(1)" style="font-size: 16px; padding: 15px 30px; margin: 10px;">
                    ğŸ›ï¸ Má»Ÿ Sáº£n Pháº©m Shopee
                </a>
                <br>
                <button class="btn-copy-single" onclick="copyLink('${result.affiliateLink.replace(/'/g, "\\'")}', 1)" 
                        style="font-size: 14px; padding: 12px 25px; margin-top: 10px;">
                    ğŸ“‹ Copy Affiliate Link
                </button>
                <div style="margin-top: 10px; font-size: 12px; color: #999;">
                    Link sáº½ má»Ÿ trong tab má»›i vá»›i tracking Ä‘áº§y Ä‘á»§
                </div>
            </div>
            
            <details style="margin-top: 20px; text-align: left;">
                <summary style="cursor: pointer; color: #666; font-size: 12px; margin-bottom: 10px;">
                    ğŸ“‹ Xem link Ä‘áº§y Ä‘á»§ vÃ  tracking info
                </summary>
                <div class="link-generated">
                    <strong>ğŸ”— Affiliate Link Ä‘áº§y Ä‘á»§:</strong><br>
                    <div style="word-break: break-all; margin-top: 5px; font-size: 11px;">
                        ${result.affiliateLink}
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 11px; color: #666;">
                    <strong>ğŸ“Š Tracking Info:</strong><br>
                    â€¢ Type: ${result.productInfo.type}<br>
                </div>
            </details>
        `;
            } else {
                linkDiv.innerHTML = `
            <div style="font-weight: bold; color: #e74c3c; margin-bottom: 15px; font-size: 16px;">
                âŒ KhÃ´ng thá»ƒ táº¡o link
            </div>
            <div class="link-original" style="text-align: left;">
                <strong>Link gá»‘c:</strong><br>${result.original}
            </div>
            <div style="color: #e74c3c; font-weight: bold; margin-top: 15px; font-size: 14px;">
                ${result.affiliateLink}
            </div>
        `;
            }

            generatedLinks.appendChild(linkDiv);
            resultsSection.style.display = 'block';
        }

        function copyAllResults() {
            const linkDiv = document.querySelector('.converted-link .link-generated div');
            if (!linkDiv) {
                showError('ChÆ°a cÃ³ affiliate link nÃ o Ä‘á»ƒ copy!');
                return;
            }

            const linkText = linkDiv.textContent.trim();
            if (linkText && linkText.startsWith('https://')) {
                navigator.clipboard.writeText(linkText).then(() => {
                    showSuccessMessage();
                }).catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = linkText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showSuccessMessage();
                });
            } else {
                showError('KhÃ´ng cÃ³ affiliate link Ä‘á»ƒ copy!');
            }
        }

        function copyLink(link, index) {
            navigator.clipboard.writeText(link).then(() => {
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = 'âœ… ÄÃ£ copy!';
                button.style.background = '#28a745';

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#17a2b8';
                }, 2000);
            }).catch(() => {
                showError('KhÃ´ng thá»ƒ copy link. Vui lÃ²ng copy thá»§ cÃ´ng.');
            });
        }

        function trackClick(index) {
            console.log(`Clicked on affiliate link ${index} at ${new Date().toLocaleString()}`);
        }

        function showSuccessMessage() {
            const successMessage = document.getElementById('successMessage');
            if (successMessage) {
                successMessage.style.display = 'block';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 10000);
            }
        }

        function clearAll() {
            document.getElementById('inputLinks').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            hideError();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function () {
            const inputLinks = document.getElementById('inputLinks');

            // Auto focus
            if (inputLinks) {
                inputLinks.focus();
            }

            // Keyboard shortcut
            if (inputLinks) {
                inputLinks.addEventListener('keydown', function (e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        generateAffiliateLinks();
                    }
                });

                // Clear error when typing
                inputLinks.addEventListener('input', function () {
                    hideError();
                });

                // Auto-detect when user pastes a full link
                inputLinks.addEventListener('paste', function (e) {
                    setTimeout(() => {
                        const pastedText = this.value.trim();
                        if (pastedText && isValidShopeeLink(pastedText) && !isShortLink(pastedText)) {
                            // Show success hint
                            showSuccess('âœ… PhÃ¡t hiá»‡n link Ä‘áº§y Ä‘á»§! Nháº¥n "ğŸ”„ Táº¡o LiÃªn Káº¿t" hoáº·c Ctrl+Enter');
                        }
                    }, 100);
                });
            }
        });

        // Má»Ÿ link vÃ  hÆ°á»›ng dáº«n user copy
        function openAndGuideUser(shortUrl) {
            // Má»Ÿ link trong tab má»›i
            const newWindow = window.open(shortUrl, '_blank');

            // Hiá»ƒn thá»‹ hÆ°á»›ng dáº«n step-by-step
            showStepByStepGuide();

            // Focus vÃ o input Ä‘á»ƒ sáºµn sÃ ng paste
            setTimeout(() => {
                document.getElementById('inputLinks').focus();
            }, 1000);
        }

        function showStepByStepGuide() {
            const guideHTML = `
        <div style="background: #28a745; color: white; padding: 20px; border-radius: 10px; margin: 15px 0; 
                    animation: pulse 2s infinite; border-left: 5px solid #155724;">
            <h3>ğŸ”¥ ÄÃ£ má»Ÿ link! LÃ m theo cÃ¡c bÆ°á»›c:</h3>
            
            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">
                    ğŸ‘€ NHÃŒN VÃ€O TAB Má»šI:
                </div>
                <div style="font-size: 16px; line-height: 1.6;">
                    <strong>BÆ°á»›c 1:</strong> Chá» trang Shopee táº£i xong (2-3 giÃ¢y)<br>
                    <strong>BÆ°á»›c 2:</strong> Click vÃ o thanh Ä‘á»‹a chá»‰ trÃ¬nh duyá»‡t<br>
                    <strong>BÆ°á»›c 3:</strong> Nháº¥n Ctrl+A (chá»n háº¿t URL) â†’ Ctrl+C (copy)<br>
                    <strong>BÆ°á»›c 4:</strong> Quay láº¡i Ä‘Ã¢y vÃ  nháº¥n Ctrl+V (paste)
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <div style="font-size: 16px; font-weight: bold; color: #fff3cd;">
                    ğŸ’¡ Máº¹o: Ã” input Ä‘Ã£ Ä‘Æ°á»£c focus, chá»‰ cáº§n Ctrl+V lÃ  xong!
                </div>
            </div>
        </div>
    `;

            showError(guideHTML, 60000); // Hiá»ƒn thá»‹ 60 giÃ¢y
        }

        function showSuccess(message, duration = 15000) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
        animation: slideInDown 0.5s ease-out;
    `;
            successDiv.innerHTML = message;

            const container = document.querySelector('.input-group');
            container.appendChild(successDiv);

            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.style.animation = 'fadeOut 0.5s ease-out';
                    setTimeout(() => {
                        if (successDiv.parentNode) {
                            successDiv.parentNode.removeChild(successDiv);
                        }
                    }, 500);
                }
            }, duration);
        }
    </script>
</body>

</html>